<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interfaz Unificada Moderna - Gymtec ERP</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/ticket-detail.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="js/config.js"></script>
    <style>
        /* Estilos adicionales para la demo */
        .demo-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: #f8fafc;
            min-height: 100vh;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .demo-title {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .demo-subtitle {
            color: #6b7280;
            font-size: 1.1rem;
            font-weight: 400;
        }
        
        .demo-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .feature-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .feature-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .feature-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .feature-description {
            color: #6b7280;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .status-panel {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 2rem 0;
            font-family: 'Courier New', monospace;
        }
        
        .status-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.75rem;
            border-radius: 8px;
            backdrop-filter: blur(4px);
        }
        
        .status-label {
            font-size: 0.75rem;
            color: #d1d5db;
            margin-bottom: 0.25rem;
        }
        
        .status-value {
            font-size: 1rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <!-- Header de la demo -->
        <div class="demo-header">
            <h1 class="demo-title">Interfaz Unificada Moderna</h1>
            <p class="demo-subtitle">
                Experiencia mejorada para comentarios y adjuntos, inspirada en las mejores aplicaciones modernas
            </p>
        </div>

        <!-- Panel de características -->
        <div class="demo-features">
            <div class="feature-card">
                <div class="feature-icon">
                    <i data-lucide="message-circle" class="w-6 h-6" style="color: white;"></i>
                </div>
                <div class="feature-title">Composición Inteligente</div>
                <div class="feature-description">
                    Textarea que se expande automáticamente y contador de caracteres en tiempo real.
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i data-lucide="image-plus" class="w-6 h-6" style="color: white;"></i>
                </div>
                <div class="feature-title">Drag & Drop Elegante</div>
                <div class="feature-description">
                    Zona de arrastre con animaciones fluidas y feedback visual inmediato.
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i data-lucide="keyboard" class="w-6 h-6" style="color: white;"></i>
                </div>
                <div class="feature-title">Atajos de Teclado</div>
                <div class="feature-description">
                    Cmd/Ctrl + Enter para enviar rápidamente, igual que en Slack o Discord.
                </div>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i data-lucide="clipboard" class="w-6 h-6" style="color: white;"></i>
                </div>
                <div class="feature-title">Pegar Imágenes</div>
                <div class="feature-description">
                    Pega imágenes directamente desde el portapapeles con Ctrl+V.
                </div>
            </div>
        </div>

        <!-- Panel de estado -->
        <div class="status-panel">
            <div class="status-title">
                <i data-lucide="activity" class="w-5 h-5"></i>
                Estado en Tiempo Real
            </div>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-label">Caracteres</div>
                    <div class="status-value" id="demo-char-count">0</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Adjuntos</div>
                    <div class="status-value" id="demo-attachment-count">0</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Estado Botón</div>
                    <div class="status-value" id="demo-button-state">Deshabilitado</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Última Acción</div>
                    <div class="status-value" id="demo-last-action">Ninguna</div>
                </div>
            </div>
        </div>

        <!-- Interfaz Unificada -->
        <div class="ticket-section-card">
            <div class="ticket-section-header">
                <h3 class="ticket-section-title">
                    <i data-lucide="edit-3" class="w-5 h-5"></i>
                    Prueba la Nueva Interfaz
                </h3>
                <div class="section-subtitle">
                    Escribe comentarios y adjunta fotos en una experiencia completamente renovada
                </div>
            </div>
            
            <!-- Interfaz Unificada Moderna -->
            <div class="unified-comment-interface-modern">
                <!-- Área de composición principal -->
                <div class="composer-container">
                    <!-- Textarea expandible -->
                    <div class="composer-input-wrapper">
                        <textarea 
                            id="unified-comment-textarea" 
                            class="composer-textarea" 
                            placeholder="¿Qué quieres compartir? Escribe tu comentario aquí... También puedes pegar imágenes con Ctrl+V"
                            rows="1"
                        ></textarea>
                        
                        <!-- Indicador de caracteres -->
                        <div class="character-counter">
                            <span id="char-count">0</span>
                        </div>
                    </div>
                    
                    <!-- Zona de drop elegante -->
                    <div id="unified-drop-zone" class="drop-zone-elegant" data-active="false">
                        <div class="drop-zone-content">
                            <div class="drop-icon-container">
                                <i data-lucide="image-plus" class="drop-icon"></i>
                            </div>
                            <div class="drop-text">
                                <p class="drop-primary">Arrastra imágenes aquí</p>
                                <p class="drop-secondary">o haz clic para explorar</p>
                            </div>
                            <div class="drop-badge">
                                JPG, PNG, GIF • Máx. 1MB
                            </div>
                        </div>
                        <input type="file" id="unified-file-input" class="file-input-hidden" accept="image/*" multiple>
                    </div>
                    
                    <!-- Vista previa de adjuntos -->
                    <div id="attachments-preview" class="attachments-preview-modern hidden">
                        <!-- Los adjuntos aparecerán aquí -->
                    </div>
                </div>
                
                <!-- Barra de herramientas moderna -->
                <div class="composer-toolbar">
                    <div class="toolbar-section left">
                        <button type="button" id="attach-photos-btn" class="toolbar-action-btn" title="Adjuntar fotos">
                            <i data-lucide="camera" class="w-4 h-4"></i>
                            <span class="action-label">Fotos</span>
                        </button>
                        
                        <button type="button" id="attach-files-btn" class="toolbar-action-btn" title="Adjuntar archivos">
                            <i data-lucide="paperclip" class="w-4 h-4"></i>
                            <span class="action-label">Adjuntar</span>
                        </button>
                        
                        <button type="button" id="add-emoji-btn" class="toolbar-action-btn" title="Agregar emoji">
                            <i data-lucide="smile" class="w-4 h-4"></i>
                        </button>
                        
                        <div class="toolbar-divider"></div>
                        
                        <button type="button" id="format-bold-btn" class="toolbar-format-btn" title="Negrita">
                            <i data-lucide="bold" class="w-4 h-4"></i>
                        </button>
                        
                        <button type="button" id="format-italic-btn" class="toolbar-format-btn" title="Cursiva">
                            <i data-lucide="italic" class="w-4 h-4"></i>
                        </button>
                    </div>
                    
                    <div class="toolbar-section right">
                        <div class="send-options">
                            <button type="button" id="save-draft-btn" class="draft-btn" title="Guardar borrador">
                                <i data-lucide="save" class="w-4 h-4"></i>
                                Borrador
                            </button>
                            
                            <button id="send-comment-btn" class="send-btn" disabled title="Enviar comentario (Cmd+Enter)">
                                <div class="send-btn-content">
                                    <i data-lucide="send" class="w-4 h-4"></i>
                                    <span class="send-text">Enviar</span>
                                </div>
                                <div class="send-shortcut">⌘↵</div>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Indicadores de estado -->
                <div class="composer-status hidden" id="composer-status">
                    <div class="status-indicator">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span class="status-text">Enviando...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Instrucciones -->
        <div class="feature-card" style="margin-top: 2rem;">
            <div class="feature-title">🚀 Instrucciones de Prueba</div>
            <div class="feature-description">
                <ul style="margin: 1rem 0; padding-left: 1.5rem; line-height: 1.6;">
                    <li><strong>Escribir:</strong> Haz clic en el área de texto y escribe algo</li>
                    <li><strong>Adjuntar:</strong> Arrastra imágenes sobre la zona azul o haz clic en "Fotos"</li>
                    <li><strong>Pegar:</strong> Copia una imagen y pégala con Ctrl+V</li>
                    <li><strong>Enviar:</strong> Usa el botón "Enviar" o presiona Cmd/Ctrl+Enter</li>
                    <li><strong>Observar:</strong> Mira como cambia el panel de estado en tiempo real</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // === CONFIGURACIÓN DE DEMO ===
        
        // Estado global para la demo
        window.state = {
            currentTicket: { id: 'demo-ticket' }
        };

        // Variables globales
        let unifiedAttachments = [];
        let unifiedDropZone = null;
        let unifiedTextarea = null;
        let unifiedSubmitBtn = null;

        // Referencias a elementos de demo
        const demoCharCount = document.getElementById('demo-char-count');
        const demoAttachmentCount = document.getElementById('demo-attachment-count');
        const demoButtonState = document.getElementById('demo-button-state');
        const demoLastAction = document.getElementById('demo-last-action');

        // Función para actualizar panel de demo
        function updateDemoStatus(action = null) {
            if (action) {
                demoLastAction.textContent = action;
            }
            
            if (unifiedTextarea) {
                demoCharCount.textContent = unifiedTextarea.value.length;
            }
            
            demoAttachmentCount.textContent = unifiedAttachments.length;
            
            if (unifiedSubmitBtn) {
                demoButtonState.textContent = unifiedSubmitBtn.disabled ? 'Deshabilitado' : 'Habilitado';
                demoButtonState.style.color = unifiedSubmitBtn.disabled ? '#ef4444' : '#10b981';
            }
        }

        // Función de logging mejorada
        function showToast(message, type = 'info') {
            updateDemoStatus(message);
            
            // Crear toast visual
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 1000;
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                `;
                document.body.appendChild(toastContainer);
            }
            
            const toast = document.createElement('div');
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                warning: '#f59e0b',
                info: '#6366f1'
            };
            
            toast.style.cssText = `
                background: ${colors[type] || colors.info};
                color: white;
                padding: 12px 16px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                transform: translateX(100%);
                transition: transform 0.3s ease;
                max-width: 300px;
            `;
            
            toast.textContent = message;
            toastContainer.appendChild(toast);
            
            requestAnimationFrame(() => {
                toast.style.transform = 'translateX(0)';
            });
            
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // Auto-resize del textarea
        function autoResizeTextarea() {
            unifiedTextarea.style.height = 'auto';
            const newHeight = Math.min(Math.max(unifiedTextarea.scrollHeight, 52), 200);
            unifiedTextarea.style.height = newHeight + 'px';
        }

        // Configurar contador de caracteres
        function setupCharacterCounter() {
            const charCount = document.getElementById('char-count');
            if (!charCount) return;
            
            unifiedTextarea.addEventListener('input', () => {
                const count = unifiedTextarea.value.length;
                charCount.textContent = count;
                updateDemoStatus('Escribiendo...');
                
                if (count > 500) {
                    charCount.style.color = '#dc2626';
                } else if (count > 300) {
                    charCount.style.color = '#f59e0b';
                } else {
                    charCount.style.color = '#6b7280';
                }
            });
        }

        // Manejar atajos de teclado
        function handleUnifiedKeydown(e) {
            if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
                e.preventDefault();
                if (!unifiedSubmitBtn.disabled) {
                    handleUnifiedSubmit();
                }
            }
        }

        // Manejar cambios en el textarea
        function handleUnifiedTextChange() {
            const hasText = unifiedTextarea.value.trim().length > 0;
            const hasAttachments = unifiedAttachments.length > 0;
            
            unifiedSubmitBtn.disabled = !hasText && !hasAttachments;
            updateDropZonePlaceholder(hasText);
            updateDemoStatus();
        }

        // Actualizar placeholder de la zona de drop
        function updateDropZonePlaceholder(hasText) {
            const dropPrimary = unifiedDropZone.querySelector('.drop-primary');
            const dropSecondary = unifiedDropZone.querySelector('.drop-secondary');
            
            if (hasText) {
                dropPrimary.textContent = 'Agrega imágenes a tu comentario';
                dropSecondary.textContent = 'Las fotos ayudan a explicar mejor';
            } else {
                dropPrimary.textContent = 'Arrastra imágenes aquí';
                dropSecondary.textContent = 'o haz clic para explorar';
            }
        }

        // Manejar paste de imágenes
        function handleUnifiedPaste(e) {
            const items = Array.from(e.clipboardData.items);
            const imageItems = items.filter(item => item.type.startsWith('image/'));
            
            if (imageItems.length > 0) {
                e.preventDefault();
                imageItems.forEach(item => {
                    const file = item.getAsFile();
                    if (file) {
                        addUnifiedAttachment(file);
                    }
                });
                showToast('✅ Imagen pegada desde portapapeles', 'success');
            }
        }

        // Manejar drag over
        function handleUnifiedDragOver(e) {
            e.preventDefault();
            unifiedDropZone.setAttribute('data-active', 'true');
            updateDemoStatus('Arrastrando archivo...');
        }

        // Manejar drag leave
        function handleUnifiedDragLeave(e) {
            e.preventDefault();
            unifiedDropZone.setAttribute('data-active', 'false');
        }

        // Manejar drop
        function handleUnifiedDrop(e) {
            e.preventDefault();
            unifiedDropZone.setAttribute('data-active', 'false');
            
            const files = Array.from(e.dataTransfer.files);
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length > 0) {
                imageFiles.forEach(file => addUnifiedAttachment(file));
                showToast(`✅ ${imageFiles.length} imagen(es) agregada(s)`, 'success');
            } else {
                showToast('⚠️ Solo se permiten archivos de imagen', 'warning');
            }
        }

        // Manejar selección de archivos
        function handleUnifiedFileSelect(e) {
            const files = Array.from(e.target.files);
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            imageFiles.forEach(file => addUnifiedAttachment(file));
            
            if (imageFiles.length > 0) {
                showToast(`✅ ${imageFiles.length} imagen(es) seleccionada(s)`, 'success');
            }
            
            e.target.value = '';
        }

        // Agregar archivo adjunto
        function addUnifiedAttachment(file) {
            if (file.size > 1024 * 1024) {
                showToast(`❌ "${file.name}" es demasiado grande (máx. 1MB)`, 'error');
                return;
            }
            
            if (!file.type.startsWith('image/')) {
                showToast(`❌ "${file.name}" no es una imagen válida`, 'error');
                return;
            }
            
            const attachment = {
                id: Date.now() + Math.random(),
                file: file,
                name: file.name,
                size: file.size,
                type: file.type,
                preview: null
            };
            
            const reader = new FileReader();
            reader.onload = (e) => {
                attachment.preview = e.target.result;
                unifiedAttachments.push(attachment);
                renderUnifiedAttachments();
                handleUnifiedTextChange();
            };
            reader.readAsDataURL(file);
        }

        // Renderizar adjuntos
        function renderUnifiedAttachments() {
            const container = document.getElementById('attachments-preview');
            
            if (unifiedAttachments.length === 0) {
                container.classList.add('hidden');
                return;
            }
            
            container.classList.remove('hidden');
            container.innerHTML = unifiedAttachments.map(attachment => `
                <div class="attachment-item-modern" data-id="${attachment.id}">
                    <img src="${attachment.preview}" alt="${attachment.name}" class="attachment-preview-modern">
                    <div class="attachment-info-modern">
                        <div class="attachment-name-modern">${attachment.name}</div>
                        <div class="attachment-size-modern">${(attachment.size / 1024).toFixed(1)} KB</div>
                    </div>
                    <button type="button" class="attachment-remove-modern" onclick="removeUnifiedAttachment('${attachment.id}')" title="Remover">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
            `).join('');
            
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // Remover adjunto
        function removeUnifiedAttachment(attachmentId) {
            const attachment = unifiedAttachments.find(att => att.id == attachmentId);
            if (attachment) {
                showToast(`🗑️ "${attachment.name}" removida`, 'info');
            }
            
            unifiedAttachments = unifiedAttachments.filter(att => att.id != attachmentId);
            renderUnifiedAttachments();
            handleUnifiedTextChange();
        }

        // Manejar envío (simulado)
        function handleUnifiedSubmit() {
            const comment = unifiedTextarea.value.trim();
            const hasText = comment.length > 0;
            const hasAttachments = unifiedAttachments.length > 0;
            
            if (!hasText && !hasAttachments) {
                showToast('⚠️ Escribe algo o agrega una imagen', 'warning');
                return;
            }
            
            showToast('🚀 Enviando comentario...', 'info');
            
            // Simular envío
            setTimeout(() => {
                showToast('✅ ¡Comentario enviado exitosamente!', 'success');
                clearUnifiedInterface();
            }, 1500);
        }

        // Limpiar interfaz
        function clearUnifiedInterface() {
            unifiedTextarea.value = '';
            unifiedTextarea.style.height = '52px';
            unifiedAttachments = [];
            renderUnifiedAttachments();
            handleUnifiedTextChange();
            
            const charCount = document.getElementById('char-count');
            if (charCount) {
                charCount.textContent = '0';
                charCount.style.color = '#6b7280';
            }
        }

        // Inicializar demo
        function initUnifiedInterface() {
            unifiedTextarea = document.getElementById('unified-comment-textarea');
            unifiedSubmitBtn = document.getElementById('send-comment-btn');
            unifiedDropZone = document.getElementById('unified-drop-zone');
            
            if (!unifiedTextarea || !unifiedSubmitBtn || !unifiedDropZone) {
                console.warn('Elementos no encontrados');
                return;
            }
            
            // Event listeners
            unifiedTextarea.addEventListener('input', handleUnifiedTextChange);
            unifiedTextarea.addEventListener('paste', handleUnifiedPaste);
            unifiedTextarea.addEventListener('keydown', handleUnifiedKeydown);
            unifiedTextarea.addEventListener('input', autoResizeTextarea);
            
            unifiedDropZone.addEventListener('click', () => {
                document.getElementById('unified-file-input').click();
            });
            
            unifiedDropZone.addEventListener('dragover', handleUnifiedDragOver);
            unifiedDropZone.addEventListener('dragleave', handleUnifiedDragLeave);
            unifiedDropZone.addEventListener('drop', handleUnifiedDrop);
            
            document.getElementById('unified-file-input').addEventListener('change', handleUnifiedFileSelect);
            unifiedSubmitBtn.addEventListener('click', handleUnifiedSubmit);
            
            document.getElementById('attach-photos-btn').addEventListener('click', () => {
                document.getElementById('unified-file-input').click();
            });
            
            setupCharacterCounter();
            updateDemoStatus('Interfaz iniciada');
            
            console.log('✅ Demo inicializada');
        }

        // Inicializar cuando cargue la página
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar iconos
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            // Inicializar interfaz
            initUnifiedInterface();
            
            // Actualizar demo cada segundo
            setInterval(updateDemoStatus, 1000);
        });

        // Hacer funciones disponibles globalmente
        window.removeUnifiedAttachment = removeUnifiedAttachment;
    </script>
</body>
</html>
