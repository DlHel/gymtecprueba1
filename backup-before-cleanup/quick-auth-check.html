<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Auth Check</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #e8f5e9; border: 1px solid #4caf50; }
        .error { background: #ffebee; border: 1px solid #f44336; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Quick Auth Check</h1>
    
    <button onclick="checkAuth()">Check Auth</button>
    <button onclick="testAPI()">Test API</button>
    <button onclick="goLogin()">Go to Login</button>
    
    <div id="results"></div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        function addResult(content, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = content;
            results.appendChild(div);
        }
        
        function checkAuth() {
            addResult('<h3>Checking Auth Status...</h3>');
            
            try {
                const isAuth = AuthManager ? AuthManager.isAuthenticated() : false;
                const token = AuthManager ? AuthManager.getToken() : null;
                const user = AuthManager ? AuthManager.getCurrentUser() : null;
                
                addResult(`
                    <strong>AuthManager Available:</strong> ${typeof AuthManager !== 'undefined'}<br>
                    <strong>Is Authenticated:</strong> ${isAuth}<br>
                    <strong>Has Token:</strong> ${!!token}<br>
                    <strong>Token Preview:</strong> ${token ? token.substring(0, 30) + '...' : 'None'}<br>
                    <strong>User:</strong> ${user ? JSON.stringify(user) : 'None'}
                `, isAuth ? 'success' : 'error');
                
            } catch (error) {
                addResult(`Error checking auth: ${error.message}`, 'error');
            }
        }
        
        async function testAPI() {
            addResult('<h3>Testing API...</h3>');
            
            try {
                if (!AuthManager || !AuthManager.isAuthenticated()) {
                    addResult('Not authenticated - cannot test API', 'error');
                    return;
                }
                
                const response = await fetch(`${API_URL}/tickets/7/detail`, {
                    headers: {
                        'Authorization': `Bearer ${AuthManager.getToken()}`
                    }
                });
                
                addResult(`
                    <strong>API Response:</strong> ${response.status} ${response.statusText}<br>
                    <strong>Result:</strong> ${response.ok ? 'SUCCESS' : 'FAILED'}
                `, response.ok ? 'success' : 'error');
                
                if (!response.ok) {
                    const text = await response.text();
                    addResult(`Error details: ${text}`, 'error');
                }
                
            } catch (error) {
                addResult(`API test failed: ${error.message}`, 'error');
            }
        }
        
        function goLogin() {
            window.location.href = '/login.html';
        }
        
        // Auto-run check
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkAuth, 100);
        });
    </script>
</body>
</html>
