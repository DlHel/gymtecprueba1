<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Logs - Gymtec ERP</title>
    <style>
        body { 
            font-family: monospace; 
            margin: 0; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #e5e5e5; 
        }
        .header { 
            background: #2d2d2d; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 20px; 
        }
        .controls { 
            margin-bottom: 20px; 
        }
        button { 
            background: #3b82f6; 
            color: white; 
            border: none; 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            margin-right: 10px; 
            margin-bottom: 5px;
        }
        button:hover { background: #2563eb; }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
        .log-container { 
            background: #111; 
            border: 1px solid #333; 
            border-radius: 8px; 
            padding: 15px; 
            max-height: 70vh; 
            overflow-y: auto; 
        }
        .log-entry { 
            margin-bottom: 8px; 
            padding: 5px 8px; 
            border-radius: 4px; 
            font-size: 13px; 
        }
        .log-info { background: rgba(59, 130, 246, 0.1); color: #60a5fa; }
        .log-success { background: rgba(16, 185, 129, 0.1); color: #34d399; }
        .log-warn { background: rgba(245, 158, 11, 0.1); color: #fbbf24; }
        .log-error { background: rgba(239, 68, 68, 0.1); color: #f87171; }
        .log-system { background: rgba(139, 92, 246, 0.1); color: #a78bfa; }
        .timestamp { color: #6b7280; font-size: 11px; }
        .source { 
            display: inline-block; 
            background: #374151; 
            color: #e5e5e5; 
            padding: 2px 6px; 
            border-radius: 3px; 
            font-size: 10px; 
            margin-right: 8px; 
        }
        .page { color: #9ca3af; font-size: 11px; }
        .stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
            gap: 10px; 
            margin-bottom: 20px; 
        }
        .stat { 
            background: #2d2d2d; 
            padding: 10px; 
            border-radius: 6px; 
            text-align: center; 
        }
        .stat-value { font-size: 24px; font-weight: bold; }
        .stat-label { font-size: 12px; color: #9ca3af; }
        .filters { 
            margin-bottom: 15px; 
        }
        select { 
            background: #374151; 
            color: #e5e5e5; 
            border: 1px solid #4b5563; 
            padding: 5px 10px; 
            border-radius: 4px; 
            margin-right: 10px; 
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Debug Logs - Gymtec ERP</h1>
        <p>Logs persistentes del sistema de autenticaci√≥n y navegaci√≥n</p>
    </div>
    
    <div class="stats" id="stats"></div>
    
    <div class="controls">
        <button onclick="refreshLogs()">üîÑ Actualizar</button>
        <button onclick="clearLogs()" class="danger">üóëÔ∏è Limpiar Logs</button>
        <button onclick="exportLogs()">üì• Exportar</button>
        <button onclick="autoRefresh()">‚ö° Auto-refresh</button>
        <button onclick="goBack()">‚Üê Volver</button>
    </div>
    
    <div class="filters">
        <select id="filterType" onchange="applyFilters()">
            <option value="">Todos los tipos</option>
            <option value="info">Info</option>
            <option value="success">Success</option>
            <option value="warn">Warning</option>
            <option value="error">Error</option>
            <option value="system">System</option>
        </select>
        
        <select id="filterSource" onchange="applyFilters()">
            <option value="">Todas las fuentes</option>
            <option value="auth">Auth</option>
            <option value="tickets">Tickets</option>
            <option value="navigation">Navigation</option>
            <option value="console">Console</option>
            <option value="system">System</option>
        </select>
        
        <select id="filterPage" onchange="applyFilters()">
            <option value="">Todas las p√°ginas</option>
            <option value="login">Login</option>
            <option value="tickets">Tickets</option>
            <option value="index">Dashboard</option>
        </select>
    </div>
    
    <div class="log-container" id="logContainer">
        <p>Cargando logs...</p>
    </div>
    
    <script src="js/config.js"></script>
    <script src="js/persistent-logger.js"></script>
    
    <script>
        let autoRefreshInterval = null;
        let currentFilter = {};
        
        function refreshLogs() {
            const logs = DebugLogger.getLogs(Object.keys(currentFilter).length > 0 ? currentFilter : null);
            displayLogs(logs);
            updateStats(logs);
        }
        
        function displayLogs(logs) {
            const container = document.getElementById('logContainer');
            
            if (logs.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6b7280;">No hay logs disponibles</p>';
                return;
            }
            
            const logsHtml = logs.reverse().map(log => {
                const typeClass = `log-${log.type}`;
                return `
                    <div class="log-entry ${typeClass}">
                        <span class="timestamp">${log.time}</span>
                        <span class="source">${log.source.toUpperCase()}</span>
                        <span class="page">[${log.page}]</span>
                        ${log.message}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = logsHtml;
        }
        
        function updateStats(logs) {
            const stats = {
                total: logs.length,
                errors: logs.filter(l => l.type === 'error').length,
                warnings: logs.filter(l => l.type === 'warn').length,
                success: logs.filter(l => l.type === 'success').length,
                auth: logs.filter(l => l.source === 'auth').length,
                tickets: logs.filter(l => l.source === 'tickets').length
            };
            
            const statsHtml = `
                <div class="stat">
                    <div class="stat-value">${stats.total}</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat">
                    <div class="stat-value" style="color: #f87171">${stats.errors}</div>
                    <div class="stat-label">Errores</div>
                </div>
                <div class="stat">
                    <div class="stat-value" style="color: #fbbf24">${stats.warnings}</div>
                    <div class="stat-label">Warnings</div>
                </div>
                <div class="stat">
                    <div class="stat-value" style="color: #34d399">${stats.success}</div>
                    <div class="stat-label">Success</div>
                </div>
                <div class="stat">
                    <div class="stat-value" style="color: #60a5fa">${stats.auth}</div>
                    <div class="stat-label">Auth</div>
                </div>
                <div class="stat">
                    <div class="stat-value" style="color: #a78bfa">${stats.tickets}</div>
                    <div class="stat-label">Tickets</div>
                </div>
            `;
            
            document.getElementById('stats').innerHTML = statsHtml;
        }
        
        function applyFilters() {
            const typeFilter = document.getElementById('filterType').value;
            const sourceFilter = document.getElementById('filterSource').value;
            const pageFilter = document.getElementById('filterPage').value;
            
            currentFilter = {};
            if (typeFilter) currentFilter.type = typeFilter;
            if (sourceFilter) currentFilter.source = sourceFilter;
            if (pageFilter) currentFilter.page = pageFilter;
            
            refreshLogs();
        }
        
        function clearLogs() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los logs?')) {
                DebugLogger.clearLogs();
                refreshLogs();
            }
        }
        
        function exportLogs() {
            DebugLogger.exportLogs();
        }
        
        function autoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                event.target.textContent = '‚ö° Auto-refresh';
            } else {
                autoRefreshInterval = setInterval(refreshLogs, 2000);
                event.target.textContent = '‚èπÔ∏è Stop refresh';
            }
        }
        
        function goBack() {
            window.history.back();
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            refreshLogs();
            
            // Actualizar cada 5 segundos si no hay auto-refresh
            setInterval(() => {
                if (!autoRefreshInterval) {
                    refreshLogs();
                }
            }, 5000);
        });
    </script>
</body>
</html>
